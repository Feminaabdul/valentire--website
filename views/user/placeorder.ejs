<%-include("../layouts/userlayout/header.ejs")%>

  <div class="hero-wrap hero-bread" style="background-image: url('images/bg_6.jpg');">
    <div class="container">
      <div class="row no-gutters slider-text align-items-center justify-content-center">
        <div class="col-md-9 ftco-animate text-center">
          <p class="breadcrumbs"><span class="mr-2"><a href="/">Home</a></span> <span>wishlist</span></p>
          <h1 class="mb-0 bread">My order</h1>
        </div>
      </div>
    </div>
  </div>

  <section class="ftco-section ftco-wishlist">

    <div class="container">
      <div class="row">
        <div class="col-md-12 ftco-animate">
          <div class="wishlist-list">
            <table class="table">
              <thead class="thead-primary">
                <tr class="text-center">

                  <th>product</th> 
                  <th>Delivery Address</th>
                  <th>payment type</th>
                  <th>date</th>
                  <th>total</th>
                  <th>status</th>
               


                </tr>
              </thead>
              <tbody>

                <div class="row">
                  <div class="col-md-7 py-md-5 wrap-about pb-md-5 ftco-animate">
                    <div class="heading-section-bold mb-4 mt-md-5">
                      <div class="ml-md-0">
                        <h2 class="mb-4">Orders</h2>
                           <p class="ion-ios-basket" style="color: black;"><%= count %></p>
                      </div>
                      <% if (!addorder.length) { %>
                        No orders found.
                        <% } else { %>
                          <% addorder.forEach((order)=> { %>
                            
                              
                                <% order.products.forEach((product)=> { %>
                                  <tr class="text-center"></tr>
                                
                                  <td class="product-name">
                                    <img  style="height: 100px; width: 100px;"  src="/Admins/productImages/<%= product.productId.image[0] %>" alt="<%= product.productId.productname %>">
                                    <br>   
                                    <%= product.productId.productname %>,<br>
                                    <%= product.productId.category%>,<br>

                                    <%= product.productId.description%></td><br>


                                   



                                  <td class="product-Address">
                                    <%= order.Address.name %><br>
                                      <%= order.Address.building %>, <%= order.Address.area %><br>
                                          <%= order.Address.city %>, <%= order.Address.state %><br>
                                              <%= order.Address.pincode %>
                                  </td>
                                  <td class="product-name">
                                    <%= order.paymentMethod %>
                                    
                                  </td>
                                  <td class="product-name">
                                    <%= order.createdAt.toDateString() %>
                                  </td>
                                  <td class="product-name">
                                    <%= order.totalAmount %>
                                  </td>
                                  <td class="order-status">
                                 

                                    <% if (product.returnRequested) { %>
                                      <%= product.returnRequested %>
                                    <% } else { %>
                                      <p class="text-primary font-weight-bolder"><%= order.status %></p>

                                      
                                      <% if (order.status === 'Delivered') { %>
                                        <button class="btn btn-primary return-btn" data-orderid="<%= order._id %>" data-productid="<%= product.productId._id %>">Return</button>
                                        <% } %>
                                   <% if (order.status === 'Processing'||order.status === 'shipped') { %>
                                        <form action="/cancel-order/<%= order._id %>" method="POST">
                                          <button type="submit" class="btn btn-danger">Cancel Order</button>
                                        </form>
                                      <% } %>
                                       
                                 
                                    <% } %>

                                  </td>


                                </td>
                                </tr>
                                  <% }) %> 
                            <% }) %>
                              <% } %>
                           
                              <div class="modal fade" id="cancelOrderModal" tabindex="-1" role="dialog" aria-labelledby="cancelOrderModalLabel" aria-hidden="true">
                                <div class="modal-dialog" role="document">
                                  <div class="modal-content">
                                    <div class="modal-header">
                                      <h5 class="modal-title" id="cancelOrderModalLabel">Confirm Cancel Order</h5>
                                      <button type="button" class="close" data-dismiss="modal" aria-label="Close">
                                        <span aria-hidden="true">&times;</span>
                                      </button>
                                    </div>
                                    <div class="modal-body">
                                      Are you sure you want to cancel your order?
                                    </div>
                                    <div class="modal-footer">
                                      <button type="button" class="btn btn-secondary" data-dismiss="modal">Cancel</button>
                                      <button type="button" class="btn btn-danger" id="confirmCancelOrder">
                                        Cancel Order
                                      </button>
                                    </div>
                                  </div>
                                </div>
                              </div>
                          
                    </div>
                  </div>
                </div>

              </tbody>



            </table>

          </div>
        </div>
      </div>

    </div>
  </section>


  <footer class="ftco-footer ftco-section">
    <div class="container">
      <div class="row">
        <div class="mouse">
          <a href="#" class="mouse-icon">
            <div class="mouse-wheel"><span class="ion-ios-arrow-up"></span></div>
          </a>
        </div>
      </div>
      <div class="row mb-5">
        <div class="col-md">
          <div class="ftco-footer-widget mb-4">
            <h2 class="ftco-heading-2">Minishop</h2>
            <p>Far far away, behind the word mountains, far from the countries Vokalia and Consonantia.</p>
            <ul class="ftco-footer-social list-unstyled float-md-left float-lft mt-5">
              <li class="ftco-animate"><a href="#"><span class="icon-twitter"></span></a></li>
              <li class="ftco-animate"><a href="#"><span class="icon-facebook"></span></a></li>
              <li class="ftco-animate"><a href="#"><span class="icon-instagram"></span></a></li>
            </ul>
          </div>
        </div>
        <div class="col-md">
          <div class="ftco-footer-widget mb-4 ml-md-5">
            <h2 class="ftco-heading-2">Menu</h2>
            <ul class="list-unstyled">
              <li><a href="#" class="py-2 d-block">Shop</a></li>
              <li><a href="#" class="py-2 d-block">About</a></li>
              <li><a href="#" class="py-2 d-block">Journal</a></li>
              <li><a href="#" class="py-2 d-block">Contact Us</a></li>
            </ul>
          </div>
        </div>
        <div class="col-md-4">
          <div class="ftco-footer-widget mb-4">
            <h2 class="ftco-heading-2">Help</h2>
            <div class="d-flex">
              <ul class="list-unstyled mr-l-5 pr-l-3 mr-4">
                <li><a href="#" class="py-2 d-block">Shipping Information</a></li>
                <li><a href="#" class="py-2 d-block">Returns &amp; Exchange</a></li>
                <li><a href="#" class="py-2 d-block">Terms &amp; Conditions</a></li>
                <li><a href="#" class="py-2 d-block">Privacy Policy</a></li>
              </ul>
              <ul class="list-unstyled">
                <li><a href="#" class="py-2 d-block">FAQs</a></li>
                <li><a href="#" class="py-2 d-block">Contact</a></li>
              </ul>
            </div>
          </div>
        </div>
        <div class="col-md">
          <div class="ftco-footer-widget mb-4">
            <h2 class="ftco-heading-2">Have a Questions?</h2>
            <div class="block-23 mb-3">
              <ul>
                <li><span class="icon icon-map-marker"></span><span class="text">203 Fake St. Mountain View, San
                    Francisco, California, USA</span></li>
                <li><a href="#"><span class="icon icon-phone"></span><span class="text">+2 392 3929 210</span></a></li>
                <li><a href="#"><span class="icon icon-envelope"></span><span
                      class="text">info@yourdomain.com</span></a></li>
              </ul>
            </div>
          </div>
        </div>
      </div>
      <div class="row">
        <div class="col-md-12 text-center">

          <p><!-- Link back to Colorlib can't be removed. Template is licensed under CC BY 3.0. -->
            Copyright &copy;
            <script>document.write(new Date().getFullYear());</script> All rights reserved | This template is made with
            <i class="icon-heart color-danger" aria-hidden="true"></i> by <a href="https://colorlib.com"
              target="_blank">Colorlib</a>
            <!-- Link back to Colorlib can't be removed. Template is licensed under CC BY 3.0. -->
          </p>
        </div>
      </div>
    </div>
  </footer>



  <!-- loader -->
  <div id="ftco-loader" class="show fullscreen"><svg class="circular" width="48px" height="48px">
      <circle class="path-bg" cx="24" cy="24" r="22" fill="none" stroke-width="4" stroke="#eeeeee" />
      <circle class="path" cx="24" cy="24" r="22" fill="none" stroke-width="4" stroke-miterlimit="10"
        stroke="#F96D00" />
    </svg></div>


    
  <script src="js/jquery.min.js"></script>
  <script src="js/jquery-migrate-3.0.1.min.js"></script>
  <script src="js/popper.min.js"></script>
  <script src="js/bootstrap.min.js"></script>
  <script src="js/jquery.easing.1.3.js"></script>
  <script src="js/jquery.waypoints.min.js"></script>
  <script src="js/jquery.stellar.min.js"></script>
  <script src="js/owl.carousel.min.js"></script>
  <script src="js/jquery.magnific-popup.min.js"></script>
  <script src="js/aos.js"></script>
  <script src="js/jquery.animateNumber.min.js"></script>
  <script src="js/bootstrap-datepicker.js"></script>
  <script src="js/scrollax.min.js"></script>
  <script
    src="https://maps.googleapis.com/maps/api/js?key=AIzaSyBVWaKrjvy3MaE7SQ74_uJiULgl1JY0H2s&sensor=false"></script>
  <script src="js/google-map.js"></script>
  <script src="js/main.js"></script>

  <script>
    $(document).ready(function () {

      var quantitiy = 0;
      $('.quantity-right-plus').click(function (e) {

        // Stop acting like a button
        e.preventDefault();
        // Get the field name
        var quantity = parseInt($('#quantity').val());

        // If is not undefined

        $('#quantity').val(quantity + 1);


        // Increment

      });

      $('.quantity-left-minus').click(function (e) {
        // Stop acting like a button
        e.preventDefault();
        // Get the field name
        var quantity = parseInt($('#quantity').val());

        // If is not undefined

        // Increment
        if (quantity > 0) {
          $('#quantity').val(quantity - 1);
        }
      });

    });
  </script>
<!-- Add this script at the bottom of your HTML file, after including other scripts -->
<script>
  $(document).ready(function () {
      // Handle return button click
      $('.return-btn').click(function (e) {
          e.preventDefault();
          const orderId = $(this).data('orderid');
          const productId = $(this).data('productid');
          const confirmation = confirm('Are you sure you want to return this product?');
          const $button = $(this);
          if (confirmation) {
              // Make an AJAX request to your server to handle the return logic
              $.post(`/return-product/${orderId}/${productId}`, function (data) {
                  // Handle the response from the server (e.g., update UI)
                  console.log(data);
                  // You may want to reload the page or update the UI accordingly


                    // Update the UI: Change the status to 'Pending'
                    $button.closest('tr').find('.order-status').text('Pending');



                  location.reload();
              });
          }
      });
  });
</script>

  </body>

  </html>